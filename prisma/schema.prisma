generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Entity {
  id String @id @default(cuid())

  firstname String
  lastname  String
  birthdate DateTime
  gender    String
  country   String
  browser   Json     @default("{}")
  metadata  Json     @default("{}")

  email    Email?
  wallets  Wallet[]
  accounts Account[]
  airdrops Airdrop[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum WalletType {
  EVM
}

model Wallet {
  id String @id @default(cuid())

  type       WalletType
  publicKey  String
  privateKey String
  mnemonic   String
  password   String
  metadata   Json       @default("{}")

  entityId String @unique
  entity   Entity @relation(fields: [entityId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([entityId, type])
}

enum EmailStatus {
  UNKNOWN
  PENDING
  VERIFIED
  BLOCKED
}

enum EmailPlatform {
  TUTANOTA
  PROTONMAIL
  GMAIL
}

model Email {
  id String @id @default(cuid())

  platform EmailPlatform
  username String
  password String
  status   EmailStatus   @default(UNKNOWN)
  metadata Json          @default("{}")
  usedBy   String[]      @default([])

  entityId String @unique
  entity   Entity @relation(fields: [entityId], references: [id])

  accounts Account[]

  parentId String?
  parent   Email?  @relation("EmailToEmail", fields: [parentId], references: [id])
  children Email[] @relation("EmailToEmail")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum AccountStatus {
  UNKNOWN
  PENDING
  VERIFIED
  BLOCKED
}

enum AccountPlatform {
  TWITTER
}

model Account {
  id String @id @default(cuid())

  platform AccountPlatform
  username String          @default("")
  password String
  status   AccountStatus   @default(UNKNOWN)
  metadata Json            @default("{}")
  usedBy   String[]        @default([])

  entityId String @unique
  entity   Entity @relation(fields: [entityId], references: [id])

  emailId String @unique
  email   Email  @relation(fields: [emailId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([entityId, platform], name: "entityId_platform")
  @@unique([emailId, platform], name: "emailId_platform")
}

enum AirdropStatus {
  UNKNOWN
  PENDING
  VERIFIED
  BLOCKED
}

model Airdrop {
  id       String        @id @default(cuid())
  name     String
  status   AccountStatus @default(UNKNOWN)
  metadata Json          @default("{}")

  entityId String @unique
  entity   Entity @relation(fields: [entityId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([entityId, name])
}
